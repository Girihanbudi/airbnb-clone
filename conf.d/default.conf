server {
  listen 80 default_server;
  server_name _;

  return 301 https://$server_name$request_uri;
}

server {
  listen 443 ssl default_server;
  
  ssl_certificate     /etc/nginx/ssl/test/server.crt;
  ssl_certificate_key /etc/nginx/ssl/test/server.key;

  # Catch-all
  server_name _;

  # # Serve Let's Ecnrypt verification files
  # include /etc/nginx/snippets/certbot-standalone.conf;
  

  location / {
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   Host             $host;

    proxy_pass https://host.docker.internal:3000/;
  } 

  location /api/auth/ {
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   Host             $host;

    proxy_pass https://host.docker.internal:8080/;
  } 

  location /api/user/ {
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   Host             $host;

    proxy_pass https://host.docker.internal:8081/;
  } 

  location /api/property/ {
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   Host             $host;

    proxy_pass https://host.docker.internal:8082/;
  } 
}
